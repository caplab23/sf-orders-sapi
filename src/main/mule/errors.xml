<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">


	<error-handler name="globalError_Handler" doc:id="34f77b2c-74a1-436f-b03c-9f6887d7cda4">

		<!-- APIKit router related exceptions -->
		<on-error-continue type="APIKIT:BAD_REQUEST" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="aa53df15-d2c0-4665-bef6-55a9361effaf" >
			<set-variable value="#[400]" doc:name="Set the HTTP Status - 400" doc:id="9324d9ad-ca1d-4859-96d3-c2097a0be8e3" variableName="httpStatus"/>
      <set-variable value="BAD_REQUEST" doc:name="Set Error Code" doc:id="11293baa-e224-47d0-b6c7-8d518fd2b743" variableName="errorCode"/>
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="1d6df1a3-d8d4-46cf-8a01-c281fec98de2" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="611ff9b8-55ce-4ad8-84d9-42b7d0fb4483" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="APIKIT:METHOD_NOT_ALLOWED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="9150de89-b88d-4667-b352-7a8b3c4c35a4" >
			<set-variable value="#[405]" doc:name="Set the HTTP Status - 405" doc:id="f46d69a0-3552-43aa-94c1-b208a246ee70" variableName="httpStatus" />
      <set-variable value="METHOD_NOT_ALLOWED" doc:name="Set Error Code" doc:id="bffc29ce-1e30-4b23-9cc1-23911453ac06" variableName="errorCode"/>
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="bed3d35c-8404-48db-80ee-10d8d6ceddec" variableName="errorMessage"/>
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="2904d18b-f426-47f9-873c-265b4aba7889" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="APIKIT:NOT_ACCEPTABLE" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="e637e0bf-41b0-4a61-86e0-2616601346b3" >
			<set-variable value="#[406]" doc:name="Set the HTTP Status - 406" doc:id="02460f34-ddf1-4066-8a02-b65ce4545146" variableName="httpStatus" />
      <set-variable value="NOT_ACCEPTABLE" doc:name="Set Error Code" doc:id="a517135d-8270-4394-a008-f07c1b233c4d" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="63a5865b-415e-438c-9c21-45a97b29e2a1" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="77071794-d657-4696-8dc6-b8d7183da75a" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="APIKIT:NOT_FOUND" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="09b801d4-e5bf-4125-b3f4-76c9e970d4ec" >
			<set-variable value="#[404]" doc:name="Set the HTTP Status - 404" doc:id="e1055895-b123-4d51-9094-c83481ea6e8d" variableName="httpStatus" />
      <set-variable value="NOT_FOUND" doc:name="Set Error Code" doc:id="e07cef83-16c6-48dd-b2e8-14f3eefc3c83" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="30e7492a-3243-4737-8aeb-2785edc2110e" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="1e526faa-80d5-4a54-811c-b6a040f68ce8" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="APIKIT:UNSUPPORTED_MEDIA_TYPE" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="086e5134-cea8-4a57-b513-5ae554cf809c" >
			<set-variable value="#[415]" doc:name="Set the HTTP Status - 415" doc:id="b4170e32-b654-4ad6-830e-9a99192c6d2a" variableName="httpStatus" />
      <set-variable value="UNSUPPORTED_MEDIA_TYPE" doc:name="Set Error Code" doc:id="0eb340b0-4d30-4f63-ab07-d5fc5884fbc3" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="4da20e2b-da15-48c3-a23b-34934a561af9" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="ba8ac4f1-0cb5-4af5-9fd4-033f620c8ee7" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>	
		
		<!-- HTTP Requster Related error handling -->
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="ecb60ecb-9593-49cd-aaf0-4638a02d1d05" type="HTTP:BAD_REQUEST">
			<set-variable value="#[400]" doc:name="Set the HTTP Status - 400" doc:id="8dd5f31b-f161-47b9-af84-d41b6fca0a9a" variableName="httpStatus" />
			<set-variable value="BAD_REQUEST" doc:name="Set Error Code" doc:id="d895e61b-84d0-42c1-92fd-7cb21bbdf4e9" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="eca72a14-b20d-48a2-9522-4741bcea62dc" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="17e4499e-afd6-4573-a5ba-16c0d51d00e3" name="global-prepare-error-response-sub-flow" />
		</on-error-continue>
		<on-error-continue type="HTTP:CLIENT_SECURITY" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="acab6ae3-b52c-430d-9d97-02db57141c6b" >
			<set-variable value="#[401]" doc:name="Set the HTTP Status - 401" doc:id="20e229d7-f5a4-4bca-bb35-ea19c9ca1ea7" variableName="httpStatus" />
      <set-variable value="UNAUTHORIZED" doc:name="Set Error Code" doc:id="d0ff0e38-b2b6-457e-bd0f-b2b29c8ed66d" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="5d978700-30f9-4a3b-b2f9-ab466664fb6c" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="afceef19-3317-420a-a2f3-9cb4081d3fcf" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:CONNECTIVITY" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="8a713519-8c62-4624-9a1d-37eb447e657d" >
			<set-variable value="#[503]" doc:name="Set the HTTP Status - 503" doc:id="9aba02d0-56e7-4c41-90a8-165c744d705c" variableName="httpStatus" />
      <set-variable value="SERVICE_UNAVAILABLE" doc:name="Set Error Code" doc:id="3e83ac98-95d8-485e-b4bd-770a69a14255" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="91ce8dbe-c035-4ae5-9bbd-96568afba51d" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="7eeb765f-4d26-43b7-80c3-60796f20513e" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:FORBIDDEN" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="ba55dcd8-7fd5-439c-9304-be0abf8c523b" >
			<set-variable value="#[403]" doc:name="Set the HTTP Status - 403" doc:id="f33034ad-f31b-4c85-844e-6729f05bbf1c" variableName="httpStatus" />
      <set-variable doc:name="Set Error Code" doc:id="21d2859b-b5b4-4466-869c-1dc0b6de6fcd" variableName="errorCode" value="FORBIDDEN"/>
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="f4d5346d-037f-4e1e-8ccb-a64a3b940d65" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="47347e87-fd94-4fd0-9baf-c0bb439445c7" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:INTERNAL_SERVER_ERROR" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="25e22e77-ba76-4784-8727-fb0dd6f76899" >
			<set-variable value="#[500]" doc:name="Set the HTTP Status - 500" doc:id="23fa07e6-b1d1-42f4-8919-c52578c73c9f" variableName="httpStatus" />
      <set-variable value="INTERNAL_SERVER_ERROR" doc:name="Set Error Code" doc:id="13428c1e-64ac-44cf-a11d-5814a66d6f2b" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="9dc73373-2128-40c6-a306-1b590134ab47" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="33e503d2-0a37-4bf0-83c1-bf12fd1c61fa" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:METHOD_NOT_ALLOWED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="9b12119b-c7b2-4ac6-a2b1-eabea37f2b2a" >
			<set-variable value="#[405]" doc:name="Set the HTTP Status - 405" doc:id="bbac82da-e661-47e3-b0e6-a9cd8463e4f7" variableName="httpStatus" />
      <set-variable value="METHOD_NOT_ALLOWED" doc:name="Set Error Code" doc:id="a354eda1-b4aa-42d9-b100-d199d8dea91b" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="4e003bd1-de1d-4687-80d6-d58681306bee" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="2b81d810-4d97-4606-bc26-f401c4891f7e" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:NOT_ACCEPTABLE" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="3fb55726-de77-4c21-874c-2ee2c2c32618" >
			<set-variable value="#[406]" doc:name="Set the HTTP Status - 406" doc:id="3d63fd2a-d869-42d0-9ee0-a3546bc99ba3" variableName="httpStatus" />
      <set-variable value="NOT_ACCEPTABLE" doc:name="Set Error Code" doc:id="f1790b8d-fd39-42a2-ad90-6138b070eff7" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="4fe189d9-235a-4b5f-b357-8a2a6bf8487b" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="9633c540-13f3-4af8-80b1-22428a4032b8" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:NOT_FOUND" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="51e35809-6115-4257-81b4-4af221aaab42" >
			<set-variable value="#[404]" doc:name="Set the HTTP Status - 404" doc:id="0f210152-b8cc-4588-ad18-26df90023d57" variableName="httpStatus" />
      <set-variable value="NOT_FOUND" doc:name="Set Error Code" doc:id="e8d760ef-927a-4cf3-86a8-557890239925" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="34708f57-4a23-4b5a-8f9e-7f69369840fc" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="8fb29e45-a888-4114-a1d5-92c6a9c09b88" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:PARSING" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="80ded39a-06b4-4bfe-8057-9a6b17c75ebc" >
			<set-variable value="#[400]" doc:name="Set the HTTP Status - 400" doc:id="bfac1534-972b-4125-b1e9-a8fd95a62f02" variableName="httpStatus" />
      <set-variable value="BAD_REQUEST" doc:name="Set Error Code" doc:id="8552f838-a1d6-40d3-8edd-aecab30820e0" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="4e213336-5d63-4f1d-998c-6c84d954ee7e" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="ed3d40b0-9b82-4669-a2e9-cefde6142b6a" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:RETRY_EXHAUSTED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="ad7b0323-a799-4094-8a29-0e727f32c94b" >
			<set-variable value="#[503]" doc:name="Set the HTTP Status - 503" doc:id="04c65ef6-3dc7-4387-867d-d6a2154f0f11" variableName="httpStatus" />
      <set-variable value="SERVICE_UNAVAILABLE" doc:name="Set Error Code" doc:id="10c18d8b-345f-4a54-9f94-1015bcc7f87e" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="756d6240-5cec-4db3-82d8-6401ed46a452" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="e4d2f2f0-d5d0-43bd-9817-acbcafb838cd" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:SECURITY" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="8865c034-29c4-4cd0-a875-afd90452192b" >
			<set-variable value="#[401]" doc:name="Set the HTTP Status - 401" doc:id="dd8966b8-117f-4451-aab7-d086f8aae26d" variableName="httpStatus" />
      			<set-variable value="UNAUTHORIZED" doc:name="Set Error Code" doc:id="8b1e48e4-8d63-45d9-af77-49b6f97dbb1a" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="1e178e56-08da-4790-b048-2ee60155fe75" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="5d10e472-850b-4d8b-ba5e-a948acc6f7af" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:TIMEOUT" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="b708c2e5-fa48-46c2-8176-69821ab7f983" >
			<set-variable value="#[504]" doc:name="Set the HTTP Status - 504" doc:id="ede930b3-a71c-43a9-ab60-d9449a7bffc2" variableName="httpStatus" />
      			<set-variable value="GATEWAY_TIMEOUT" doc:name="Set Error Code" doc:id="44c2aeaa-f7bf-4f06-bd72-8539513dfa2f" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="46a55bb8-cf0f-455e-82f6-9f672ea149e4" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="77670145-452b-4600-bddf-242e318626de" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:TOO_MANY_REQUESTS" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="134596c7-f0b2-4ddb-9dc6-cc1e822169bf" >
			<set-variable value="#[429]" doc:name="Set the HTTP Status - 429" doc:id="fb6615f1-d84a-4431-b7fd-18fcd0cf6eae" variableName="httpStatus" />
      			<set-variable value="TOO_MANY_REQUESTS" doc:name="Set Error Code" doc:id="86768395-b2a6-4617-81a7-cf4181fc301d" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="1984c854-38b7-4e3d-9c3f-4be3ee91e97c" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="be8db0e4-1f02-43a0-8458-62f38612a9d6" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:UNAUTHORIZED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="05fb42e3-721e-489c-9213-ec7601ddcd21" >
			<set-variable value="#[401]" doc:name="Set the HTTP Status - 401" doc:id="95813153-11b3-482e-bfdd-ce10cda0e85d" variableName="httpStatus" />
      			<set-variable value="UNAUTHORIZED" doc:name="Set Error Code" doc:id="574f57a4-264c-4708-9087-a3103abdb0ff" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="6158d74c-9a0d-40d0-8f39-f2e95dd9fb36" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="68e6f3fc-4f5d-439a-bac9-50128e017e43" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="HTTP:UNSUPPORTED_MEDIA_TYPE" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="26acd657-10e8-4e52-a4bb-d1a96aae756c" >
			<set-variable value="#[415]" doc:name="Set the HTTP Status - 415" doc:id="7b30b1b3-a3d2-4bde-ad21-da83426df025" variableName="httpStatus" />
      			<set-variable value="UNSUPPORTED_MEDIA_TYPE" doc:name="Set Error Code" doc:id="7b98201c-f0a2-46d1-a5d8-dcd6288824d6" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="2daef48c-faef-47c9-b21c-e7e718962594" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="3702f750-ec7e-4a42-bdb6-aa87443b91c6" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		
		<!-- Streaming related exception -->
		<on-error-continue type="STREAM_MAXIMUM_SIZE_EXCEEDED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="758fb9a1-9459-4815-b01f-7288c211c314" >
			<set-variable value="#[500]" doc:name="Set the HTTP Status - 500" doc:id="c122a765-d64f-4d3d-b903-7e506485fabb" variableName="httpStatus" />
      			<set-variable value="INTERNAL_SERVER_ERROR" doc:name="Set Error Code" doc:id="9fde785e-e086-46e3-b282-d2f3fdbcdcf4" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="b3904e27-0845-43df-b65d-730f3300ec2f" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="dfc1662b-f325-4a87-a295-edc91ff93cc1" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		
		<!-- Generic CONNECTIVITY Related Exception handling start. Order matters -->
		<on-error-continue type="RETRY_EXHAUSTED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="5b223b18-6fe8-4437-aa8a-49e802370155" >
			<set-variable value="#[503]" doc:name="Set the HTTP Status - 503" doc:id="bc5e4b3b-7950-46a3-8478-41d323616030" variableName="httpStatus" />
      			<set-variable value="SERVICE_UNAVAILABLE" doc:name="Set Error Code" doc:id="c24c136f-7dc4-45f9-95b9-3a247d32229a" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="c21ad01a-5960-4a19-bb14-f19cd6536c74" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="5cfe750b-1a61-403c-af47-c00609c23666" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="REDELIVERY_EXHAUSTED" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="6b7674cf-ad09-4907-9b1d-0f769b342bc7" >
			<set-variable value="#[503]" doc:name="Set the HTTP Status - 503" doc:id="fb109e61-df84-478c-b93e-fbacb6000d7a" variableName="httpStatus" />
      			<set-variable value="SERVICE_UNAVAILABLE" doc:name="Set Error Code" doc:id="5f0a4468-a712-49ca-a6c6-97bd17b9427f" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="484c7f64-92ab-4ad4-9649-b8783ba4fd80" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="a26c73cc-2825-4b73-ac4d-7d040755318c" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="CONNECTIVITY" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="1273105b-bf9a-4f9d-9717-f03d86b19289" >
			<set-variable value="#[503]" doc:name="Set the HTTP Status - 503" doc:id="a65f1d9b-9700-48f0-84bf-f99fe61ca34c" variableName="httpStatus" />
      			<set-variable value="SERVICE_UNAVAILABLE" doc:name="Set Error Code" doc:id="0bee2768-64c0-4578-9c5e-dc6408cf481b" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="7d2cf17c-b9c9-45b5-93b5-2c5f34273b15" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="d1f8e1e9-021e-48e6-97a0-0d2fcfda3f57" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="TIMEOUT" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="c7e58a55-87a3-444d-883f-83241411bf66" >
			<set-variable value="#[504]" doc:name="Set the HTTP Status - 504" doc:id="f1e1e503-dbf0-4c36-bbee-c1a015ad5c3b" variableName="httpStatus" />
      			<set-variable value="GATEWAY_TIMEOUT" doc:name="Set Error Code" doc:id="938eda0b-6de4-4458-9c2f-4124f18a491c" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="e2a56a05-c7a9-4e25-b343-628bd9df86c7" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="4f7a4f02-38d8-494c-ac1d-ea1b1f13cdba" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<!-- Generic CONNECTIVITY Exception handling end -->
		
		<on-error-continue type="TRANSFORMATION" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="267c66ef-1d9f-4cd2-a948-6f7a3a057555" >
			<set-variable value="#[400]" doc:name="Set the HTTP Status - 400" doc:id="d851f95b-4303-4627-b559-4117f7530203" variableName="httpStatus" />
      			<set-variable value="BAD_REQUEST" doc:name="Set Error Code" doc:id="6e02417e-aeda-4cbf-9836-454bf47a8cb2" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="993c0850-53a0-4399-b87b-ad930c48bff6" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="f7350a68-6d3a-4b4b-be96-5f9e09c6c421" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		
		<on-error-continue type="EXPRESSION" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="b8ccbeb8-8bf2-4427-b616-3c7d70d78fb9" >
			<set-variable value="#[500]" doc:name="Set the HTTP Status - 500" doc:id="2548eb34-3652-4da2-a4a6-a940d0b48929" variableName="httpStatus" />
			<set-variable value="INTERNAL_SERVER_ERROR" doc:name="Set Error Code" doc:id="bec1fbab-92e3-4c1a-85db-c154e8142c2c" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="895bda10-1f79-427a-be50-5e34ecf2fe3a" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="a20402ca-17c1-4424-9c06-bf9e9b47b954" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>	
		<on-error-continue type="ROUTING" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="db89779e-a585-4887-9bdd-03935277e596" >
			<set-variable value="#[400]" doc:name="Set the HTTP Status - 400" doc:id="c36275e3-0093-49e9-bf85-9a5fdefe24da" variableName="httpStatus" />
      			<set-variable value="BAD_REQUEST" doc:name="Set Error Code" doc:id="0f802289-bab6-4aea-b35c-4fdbea00dcf0" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="0fea99a2-038e-4cf2-812f-66e46aa19d1f" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="8890fae3-63ec-43a6-82e4-cc9fcbed08b0" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		<on-error-continue type="SECURITY" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="12584f5b-36d6-44c6-8b72-41dc126cea88" >
			<set-variable value="#[401]" doc:name="Set the HTTP Status - 401" doc:id="abfc2a99-68f3-416b-89b5-8788fc67c066" variableName="httpStatus" />
      			<set-variable value="UNAUTHORIZED" doc:name="Set Error Code" doc:id="75a384d3-29f1-4329-b136-7782c7e69ae2" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="44e2554a-db09-477e-b718-5b6e522bd6f4" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="1febd769-c9aa-4569-a810-20e5836e0d28" name="global-prepare-error-response-sub-flow"/>
		</on-error-continue>
		
		
		<!-- If none of the above matches then handle a the exception using generic handler -->
		<on-error-continue type="ANY" enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="5482e2ed-b00c-4283-af2a-e90827b19134">
			<set-variable value="#[500]" doc:name="Set HTTP Status - 500" variableName="httpStatus" />
			<set-variable value="INTERNAL_SERVER_ERROR" doc:name="Set Error Code" doc:id="fb71e6ee-b57b-46b4-87a4-c2d896301e83" variableName="errorCode" />
			<set-variable value='#[if (error.muleMessage.payload != null) error.muleMessage.payload else error.description default ""]' doc:name="Set Error Message" doc:id="02d9ab64-12bf-4a3d-85d1-2c8bebc3ee76" variableName="errorMessage" />
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="c4e2e87b-3a04-4ff8-a3b7-842e4afa096c" name="global-prepare-error-response-sub-flow" />
		</on-error-continue>
		
	
</error-handler>
    
    <sub-flow name="global-prepare-error-response-sub-flow" doc:id="02b4c104-fc02-4cd3-b267-cc21dc2e771f">
		<logger level="ERROR" doc:name="Logger" doc:id="1d84b41f-d45f-4caf-bdb2-f2a33805bd14" message="Status Code [#[vars.httpStatus]] - Error Code [#[vars.errorCode]] - Error Message [#[if(vars.errorMessage != null) vars.errorMessage else '']] - Error Description [#[if(vars.errorDescription != null) vars.errorDescription else '']]" />
		<ee:transform doc:name="Compose Error Payload" doc:id="503ded6c-5466-41bc-b427-ecf5b5cd6fb6">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
error: {
	error_code: vars.errorCode,
	error_datetime: now() as String { format: "yyyy-MM-dd'T'HH:mm:ssZ" },
	(error_message: vars.errorMessage) if(vars.errorMessage != null),
	(error_description: vars.errorDescription) if(vars.errorDescription != null)
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<set-variable value="#[(vars.outboundHeaders default {}) ++ {'x-correlation-id': correlationId}]" doc:name="Add correlationId to outboundHeaders" doc:id="6761dd82-8809-424a-9b7f-fb5f1b35d189" variableName="outboundHeaders" mimeType="application/java" />
    </sub-flow>
	
	</mule>
